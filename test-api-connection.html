<!DOCTYPE html>
<html>
<head>
    <title>API Connection Test</title>
</head>
<body>
    <h1>üîç API Connection Test</h1>
    <div id="results"></div>
    
    <script>
        async function testApiConnection() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing API connection...</p>';
            
            // Test the apiFetch utility logic
            const candidates = [
                'http://localhost:5000',
                'http://localhost:5001', 
                'http://localhost:5002',
                'http://localhost:5003',
                'http://localhost:5004',
                'http://localhost:5005',
            ];
            
            let workingPort = null;
            let results = [];
            
            for (const base of candidates) {
                try {
                    console.log(`Testing ${base}...`);
                    const res = await fetch(`${base}/`);
                    const isWorking = res.ok;
                    results.push(`${base}: ${isWorking ? '‚úÖ Working' : '‚ùå Failed'}`);
                    
                    if (isWorking && !workingPort) {
                        workingPort = base;
                    }
                } catch (error) {
                    results.push(`${base}: ‚ùå Connection failed`);
                }
            }
            
            // Test products endpoint
            let productsTest = 'Not tested';
            if (workingPort) {
                try {
                    const res = await fetch(`${workingPort}/api/products?category=africa&subcategory=south-africa`);
                    const data = await res.json();
                    productsTest = `‚úÖ Found ${data.products?.length || 0} products`;
                } catch (error) {
                    productsTest = `‚ùå Products API failed: ${error.message}`;
                }
            }
            
            resultsDiv.innerHTML = `
                <h2>üîç Connection Test Results:</h2>
                <div style="font-family: monospace; background: #f5f5f5; padding: 15px; border-radius: 5px;">
                    ${results.map(r => `<div>${r}</div>`).join('')}
                </div>
                
                <h3>‚úÖ Working Backend:</h3>
                <div style="font-size: 18px; color: green; font-weight: bold;">
                    ${workingPort || 'None found'}
                </div>
                
                <h3>üì¶ Products API Test:</h3>
                <div style="font-size: 16px;">
                    ${productsTest}
                </div>
                
                <h3>üíæ localStorage Status:</h3>
                <div style="font-family: monospace; background: #f0f0f0; padding: 10px;">
                    apiBase: ${localStorage.getItem('apiBase') || 'Not set'}
                </div>
                
                <h3>üîß Action Required:</h3>
                <div style="background: #e7f3ff; padding: 15px; border-radius: 5px;">
                    ${workingPort ? 
                        `‚úÖ Backend is working on ${workingPort}. Your images should now display correctly!` :
                        `‚ùå No backend found. Make sure your backend is running.`
                    }
                </div>
            `;
            
            // Set the working port in localStorage
            if (workingPort) {
                localStorage.setItem('apiBase', workingPort);
                console.log(`Set apiBase to: ${workingPort}`);
            }
        }
        
        // Run test when page loads
        testApiConnection();
    </script>
</body>
</html>



